{
  "$defs": {
    "Boolean": {
      "oneOf": [
        {
          "additionalProperties": false,
          "minProperties": 1,
          "maxProperties": 1,
          "patternProperties": {
            "^all|any$": {
              "$ref": "#/$defs/CheckList"
            }
          },
          "type": "object"
        },
        {
          "additionalProperties": false,
          "properties": {
            "not": {
              "$ref": "#/$defs/CheckItem"
            }
          },
          "required": ["not"],
          "type": "object"
        }
      ]
    },
    "CheckItem": {
      "anyOf": [
        {
          "$ref": "#/$defs/Boolean"
        },
        {
          "$ref": "#/$defs/Operator"
        }
      ]
    },
    "CheckList": {
      "items": {
        "$ref": "#/$defs/CheckItem"
      },
      "type": "array"
    },
    "Dataset": {
      "type": "string"
    },
    "OperationId": {
      "pattern": "^\\$.+$",
      "type": "string"
    },
    "Operator": {
      "additionalProperties": false,
      "properties": {
        "comparator": {
          "type": ["number", "string"]
        },
        "context": {
          "type": "string"
        },
        "date_component": {
          "enum": [
            "year",
            "month",
            "day",
            "hour",
            "minute",
            "second",
            "microsecond"
          ],
          "type": "string"
        },
        "name": {
          "anyOf": [
            {
              "$ref": "#/$defs/OperationId"
            },
            {
              "$ref": "#/$defs/VariableName"
            },
            {
              "enum": [
                "dataset_class",
                "dataset_is_non_standard",
                "dataset_label",
                "dataset_location",
                "dataset_name",
                "dataset_size",
                "dataset_structure",
                "define_variable_allowed_terms",
                "define_variable_ccode",
                "define_variable_data_type",
                "define_variable_format",
                "define_variable_label",
                "define_variable_name",
                "define_variable_origin_type",
                "define_variable_role",
                "define_variable_size",
                "variable_data_type",
                "variable_label",
                "variable_name",
                "variable_order",
                "variable_size"
              ],
              "type": "string"
            }
          ]
        },
        "operator": {
          "enum": [
            "additional_columns_empty",
            "additional_columns_not_empty",
            "conformant_value_data_type",
            "conformant_value_length",
            "contains",
            "contains_all",
            "contains_case_insensitive",
            "date_equal_to",
            "date_greater_than",
            "date_greater_than_or_equal_to",
            "date_less_than",
            "date_less_than_or_equal_to",
            "date_not_equal_to",
            "does_not_contain",
            "does_not_contain_case_insensitive",
            "does_not_have_next_corresponding_record",
            "does_not_reference_correct_codelist",
            "does_not_use_valid_codelist_terms",
            "empty",
            "empty_within_except_last_row",
            "ends_with",
            "equal_to",
            "equal_to_case_insensitive",
            "exists",
            "greater_than",
            "greater_than_or_equal_to",
            "has_different_values",
            "has_equal_length",
            "has_next_corresponding_record",
            "has_not_equal_length",
            "has_same_values",
            "invalid_date",
            "is_complete_date",
            "is_contained_by",
            "is_contained_by_case_insensitive",
            "is_false",
            "is_incomplete_date",
            "is_not_contained_by",
            "is_not_contained_by_case_insensitive",
            "is_not_ordered_by",
            "is_not_ordered_set",
            "is_not_unique_relationship",
            "is_not_unique_set",
            "is_not_valid_reference",
            "is_not_valid_relationship",
            "is_ordered_by",
            "is_ordered_set",
            "is_true",
            "is_unique_relationship",
            "is_unique_set",
            "is_valid_reference",
            "is_valid_relationship",
            "less_than",
            "less_than_or_equal_to",
            "longer_than",
            "longer_than_or_equal_to",
            "matches_regex",
            "non_conformant_value_data_type",
            "non_conformant_value_length",
            "non_empty",
            "non_empty_within_except_last_row",
            "not_contains_all",
            "not_equal_to",
            "not_equal_to_case_insensitive",
            "not_exists",
            "not_matches_regex",
            "not_prefix_matches_regex",
            "not_present_on_multiple_rows_within",
            "not_suffix_matches_regex",
            "prefix_equal_to",
            "prefix_matches_regex",
            "prefix_not_equal_to",
            "present_on_multiple_rows_within",
            "references_correct_codelist",
            "shares_at_least_one_element_with",
            "shares_exactly_one_element_with",
            "shares_no_elements_with",
            "shorter_than",
            "shorter_than_or_equal_to",
            "starts_with",
            "suffix_equal_to",
            "suffix_matches_regex",
            "suffix_not_equal_to",
            "target_is_not_sorted_by",
            "target_is_sorted_by",
            "uses_valid_codelist_terms",
            "value_does_not_have_multiple_references",
            "value_has_multiple_references"
          ],
          "type": "string"
        },
        "order": {
          "enum": ["asc", "dsc"],
          "type": "string"
        },
        "ordering": {
          "$ref": "#/$defs/VariableName"
        },
        "prefix": {
          "type": "integer"
        },
        "suffix": {
          "type": "integer"
        },
        "target": {
          "$ref": "#/$defs/VariableName"
        },
        "value": {
          "oneOf": [
            {
              "type": ["boolean", "number", "string"]
            },
            {
              "items": {
                "type": ["number"]
              },
              "type": "array"
            },
            {
              "items": {
                "type": ["string"]
              },
              "type": "array"
            }
          ]
        },
        "value_is_literal": {
          "const": true
        },
        "within": {
          "$ref": "#/$defs/VariableName"
        }
      },
      "required": ["operator"],
      "type": "object"
    },
    "VariableName": {
      "pattern": "^(--[A-Z0-9]{1,6}|[A-Z][A-Z0-9]{0,7})$",
      "type": "string"
    }
  },
  "$id": "https://cdisc.org/CORE-base.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "additionalProperties": false,
  "description": "Validation schema CDISC Rules 1.0",
  "properties": {
    "Authority": {
      "additionalProperties": false,
      "properties": {
        "Organization": {
          "const": "CDISC"
        }
      },
      "required": ["Organization"],
      "type": "object"
    },
    "Check": {
      "$ref": "#/$defs/Boolean"
    },
    "Citations": {
      "items": {
        "additionalProperties": false,
        "properties": {
          "Cited Guidance": {
            "type": "string"
          },
          "Document": {
            "type": "string"
          },
          "Item": {
            "type": "string"
          },
          "Section": {
            "type": "string"
          }
        },
        "required": ["Document", "Section", "Cited Guidance"],
        "type": "object"
      },
      "type": "array"
    },
    "Core": {
      "additionalProperties": false,
      "properties": {
        "Id": {
          "type": "string"
        },
        "Version": {
          "const": "1"
        }
      },
      "required": ["Id", "Version"],
      "type": "object"
    },
    "Description": {
      "type": "string"
    },
    "Match Datasets": {
      "items": {
        "additionalProperties": false,
        "properties": {
          "Name": {
            "$ref": "#/$defs/Dataset"
          },
          "Is Relationship": {
            "const": true
          },
          "Keys": {
            "items": {
              "$ref": "#/$defs/VariableName"
            },
            "type": "array"
          }
        },
        "required": ["Name", "Keys"],
        "type": "object"
      },
      "type": "array"
    },
    "Operations": {
      "items": {
        "additionalProperties": false,
        "properties": {
          "domain": {
            "$ref": "#/$defs/Dataset"
          },
          "group": {
            "items": {
              "$ref": "#/$defs/VariableName"
            },
            "type": "array"
          },
          "id": {
            "$ref": "#/$defs/OperationId"
          },
          "name": {
            "type": "string"
          },
          "operator": {
            "enum": [
              "distinct",
              "dy",
              "extract_metadata",
              "max",
              "max_date",
              "mean",
              "min",
              "min_date",
              "variable_exists",
              "variable_names",
              "variable_value_count"
            ],
            "type": "string"
          }
        },
        "required": ["id", "name", "operator"],
        "type": "object"
      },
      "type": "array"
    },
    "Outcome": {
      "additionalProperties": false,
      "properties": {
        "Message": {
          "type": "string"
        },
        "Output Variables": {
          "items": {
            "oneOf": [
              {
                "$ref": "#/$defs/OperationId"
              },
              {
                "$ref": "#/$defs/VariableName"
              }
            ]
          },
          "type": "array"
        }
      },
      "required": ["Message"],
      "type": "object"
    },
    "References": {
      "items": {
        "additionalProperties": false,
        "properties": {
          "Origin": {
            "type": "string"
          },
          "Rule Identifier": {
            "additionalProperties": false,
            "properties": {
              "Id": {
                "type": "string"
              },
              "Version": {
                "type": "string"
              }
            },
            "required": ["Id", "Version"],
            "type": "object"
          },
          "Version": {
            "type": "string"
          }
        },
        "required": ["Origin", "Rule Identifier", "Version"],
        "type": "object"
      },
      "minItems": 1,
      "type": "array"
    },
    "Rule Type": {
      "oneOf": [
        {
          "const": "Consistency"
        },
        {
          "const": "Data Domain Aggregation"
        },
        {
          "const": "Data Pattern and Format"
        },
        {
          "const": "Dataset Contents Check against Define XML and Library Metadata"
        },
        {
          "const": "Dataset Contents Check against Library Metadata"
        },
        {
          "const": "Dataset Metadata Check"
        },
        {
          "const": "Dataset Metadata Check against Define XML"
        },
        {
          "const": "Date Arithmetic"
        },
        {
          "const": "Define-XML"
        },
        {
          "const": "Domain Presence Check"
        },
        {
          "const": "External Dictionaries"
        },
        {
          "const": "Functional Dependency"
        },
        {
          "const": "Populated Values"
        },
        {
          "const": "Range & Limit"
        },
        {
          "const": "Relationship Integrity Check"
        },
        {
          "const": "Uniqueness"
        },
        {
          "const": "Value Level Metadata Check against Define XML"
        },
        {
          "const": "Value Presence"
        },
        {
          "const": "Variable Length"
        },
        {
          "const": "Variable Metadata Check"
        },
        {
          "const": "Variable Metadata Check against Define XML"
        },
        {
          "const": "Variable Order"
        },
        {
          "const": "Variable Presence"
        }
      ]
    },
    "Scopes": {
      "additionalProperties": false,
      "properties": {
        "Standards": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "Name": {
                "type": "string"
              },
              "Version": {
                "type": "string"
              }
            },
            "required": ["Name", "Version"],
            "type": "object"
          },
          "type": "array"
        }
      },
      "required": ["Standards"],
      "type": "object"
    },
    "Sensitivity": {
      "enum": [
        "Study",
        "Dataset",
        "Variable",
        "Code_list",
        "Term",
        "Record",
        "Value"
      ],
      "type": "string"
    },
    "Severity": {
      "enum": ["Error", "Notice", "Reject", "Warning"],
      "type": "string"
    }
  },
  "required": [
    "Authority",
    "Check",
    "Citations",
    "Core",
    "Description",
    "Outcome",
    "References",
    "Rule Type",
    "Scopes",
    "Sensitivity",
    "Severity"
  ],
  "type": "object"
}
