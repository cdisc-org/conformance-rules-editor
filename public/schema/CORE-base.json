{
  "$defs": {
    "Boolean": {
      "oneOf": [
        {
          "additionalProperties": false,
          "properties": {
            "all": { "$ref": "#/$defs/CheckItems" }
          },
          "required": ["all"],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "properties": {
            "any": { "$ref": "#/$defs/CheckItems" }
          },
          "required": ["any"],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "properties": {
            "not": {
              "$ref": "#/$defs/CheckItem"
            }
          },
          "required": ["not"],
          "type": "object"
        }
      ]
    },
    "CheckItem": {
      "anyOf": [
        {
          "$ref": "#/$defs/Boolean"
        },
        {
          "$ref": "#/$defs/Operator"
        }
      ]
    },
    "CheckItems": {
      "items": {
        "$ref": "#/$defs/CheckItem"
      },
      "type": "array"
    },
    "Classes": {
      "items": {
        "enum": [
          "All",
          "Events",
          "Findings",
          "Findings About",
          "Interventions",
          "Relationship",
          "Special-Purpose",
          "Study Reference",
          "Trial Design"
        ],
        "type": "string"
      },
      "type": "array"
    },
    "Dataset": {
      "anyOf": [
        {
          "enum": [
            "All",
            "AP--",
            "APRELSUB",
            "POOLDEF",
            "RELREC",
            "RELSPEC",
            "RELSUB",
            "SUPP--"
          ],
          "type": "string"
        },
        {
          "pattern": "^([A-Z]{2}|[A-Z]{4}|SUPP[A-Z]{2}|SUPP[A-Z]{4}|SQAP[A-Z]{4})$",
          "type": "string"
        }
      ]
    },
    "Datasets": {
      "items": {
        "$ref": "#/$defs/Dataset"
      },
      "type": "array"
    },
    "DataStructure": {
      "enum": [
        "ADAM OTHER",
        "ALL",
        "BASIC DATA STRUCTURE",
        "DEVICE LEVEL ANALYSIS DATASET",
        "MEDICAL DEVICE BASIC DATA STRUCTURE",
        "MEDICAL DEVICE OCCURRENCE DATA STRUCTURE",
        "OCCURRENCE DATA STRUCTURE",
        "SUBJECT LEVEL ANALYSIS DATASET"
      ],
      "type": "string"
    },
    "DataStructures": {
      "items": {
        "$ref": "#/$defs/DataStructure"
      },
      "type": "array"
    },
    "Domains": {
      "items": {
        "$ref": "#/$defs/Dataset"
      },
      "type": "array"
    },
    "OperationId": {
      "pattern": "^\\$.+$",
      "type": "string"
    },
    "Operator": {
      "additionalProperties": false,
      "properties": {
        "comparator": {
          "type": ["number", "string"]
        },
        "context": {
          "type": "string"
        },
        "date_component": {
          "enum": [
            "year",
            "month",
            "day",
            "hour",
            "minute",
            "second",
            "microsecond"
          ],
          "type": "string"
        },
        "name": {
          "anyOf": [
            {
              "$ref": "#/$defs/OperationId"
            },
            {
              "$ref": "#/$defs/VariableName"
            },
            {
              "enum": [
                "dataset_class",
                "dataset_is_non_standard",
                "dataset_label",
                "dataset_location",
                "dataset_name",
                "dataset_size",
                "dataset_structure",
                "define_variable_allowed_terms",
                "define_variable_ccode",
                "define_variable_data_type",
                "define_variable_format",
                "define_variable_label",
                "define_variable_name",
                "define_variable_origin_type",
                "define_variable_role",
                "define_variable_size",
                "variable_data_type",
                "variable_label",
                "variable_name",
                "variable_order",
                "variable_size"
              ],
              "type": "string"
            }
          ]
        },
        "operator": {
          "enum": [
            "additional_columns_empty",
            "additional_columns_not_empty",
            "conformant_value_data_type",
            "conformant_value_length",
            "contains",
            "contains_all",
            "contains_case_insensitive",
            "date_equal_to",
            "date_greater_than",
            "date_greater_than_or_equal_to",
            "date_less_than",
            "date_less_than_or_equal_to",
            "date_not_equal_to",
            "does_not_contain",
            "does_not_contain_case_insensitive",
            "does_not_have_next_corresponding_record",
            "does_not_reference_correct_codelist",
            "does_not_use_valid_codelist_terms",
            "empty",
            "empty_within_except_last_row",
            "ends_with",
            "equal_to",
            "equal_to_case_insensitive",
            "exists",
            "greater_than",
            "greater_than_or_equal_to",
            "has_different_values",
            "has_equal_length",
            "has_next_corresponding_record",
            "has_not_equal_length",
            "has_same_values",
            "invalid_date",
            "is_complete_date",
            "is_contained_by",
            "is_contained_by_case_insensitive",
            "is_false",
            "is_incomplete_date",
            "is_not_contained_by",
            "is_not_contained_by_case_insensitive",
            "is_not_ordered_by",
            "is_not_ordered_set",
            "is_not_unique_relationship",
            "is_not_unique_set",
            "is_not_valid_reference",
            "is_not_valid_relationship",
            "is_ordered_by",
            "is_ordered_set",
            "is_true",
            "is_unique_relationship",
            "is_unique_set",
            "is_valid_reference",
            "is_valid_relationship",
            "less_than",
            "less_than_or_equal_to",
            "longer_than",
            "longer_than_or_equal_to",
            "matches_regex",
            "non_conformant_value_data_type",
            "non_conformant_value_length",
            "non_empty",
            "non_empty_within_except_last_row",
            "not_contains_all",
            "not_equal_to",
            "not_equal_to_case_insensitive",
            "not_exists",
            "not_matches_regex",
            "not_prefix_matches_regex",
            "not_present_on_multiple_rows_within",
            "not_suffix_matches_regex",
            "prefix_equal_to",
            "prefix_matches_regex",
            "prefix_not_equal_to",
            "present_on_multiple_rows_within",
            "references_correct_codelist",
            "shares_at_least_one_element_with",
            "shares_exactly_one_element_with",
            "shares_no_elements_with",
            "shorter_than",
            "shorter_than_or_equal_to",
            "starts_with",
            "suffix_equal_to",
            "suffix_matches_regex",
            "suffix_not_equal_to",
            "target_is_not_sorted_by",
            "target_is_sorted_by",
            "uses_valid_codelist_terms",
            "value_does_not_have_multiple_references",
            "value_has_multiple_references"
          ],
          "type": "string"
        },
        "order": {
          "enum": ["asc", "dsc"],
          "type": "string"
        },
        "ordering": {
          "$ref": "#/$defs/VariableName"
        },
        "prefix": {
          "type": "integer"
        },
        "suffix": {
          "type": "integer"
        },
        "target": {
          "$ref": "#/$defs/VariableName"
        },
        "value": {
          "oneOf": [
            {
              "type": ["boolean", "number", "string"]
            },
            {
              "items": {
                "type": ["number"]
              },
              "type": "array"
            },
            {
              "items": {
                "type": ["string"]
              },
              "type": "array"
            }
          ]
        },
        "value_is_literal": {
          "const": true
        },
        "within": {
          "$ref": "#/$defs/VariableName"
        }
      },
      "required": ["operator"],
      "type": "object"
    },
    "Subclasses": {
      "items": {
        "enum": [
          "ADVERSE EVENT",
          "ALL",
          "MEDICAL DEVICE TIME-TO-EVENT",
          "NON-COMPARTMENTAL ANALYSIS",
          "TIME-TO-EVENT"
        ],
        "type": "string"
      },
      "type": "array"
    },
    "VariableName": {
      "pattern": "^(--[A-Z0-9]{1,6}|[A-Z][A-Z0-9]{0,7})$",
      "type": "string"
    }
  },
  "$id": "https://cdisc.org/CORE-base.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "additionalProperties": false,
  "description": "Validation schema CDISC Rules 1.0",
  "properties": {
    "Authority": {
      "additionalProperties": false,
      "properties": {
        "Organization": {
          "anyOf": [{ "type": "string" }, { "const": "CDISC" }]
        }
      },
      "required": ["Organization"],
      "type": "object"
    },
    "Check": {
      "$ref": "#/$defs/Boolean"
    },
    "Citations": {
      "items": {
        "additionalProperties": false,
        "properties": {
          "Cited Guidance": {
            "type": "string"
          },
          "Document": {
            "type": "string"
          },
          "Item": {
            "type": "string"
          },
          "Section": {
            "type": "string"
          }
        },
        "required": ["Document", "Section", "Cited Guidance"],
        "type": "object"
      },
      "type": "array"
    },
    "Core": {
      "additionalProperties": false,
      "properties": {
        "Id": {
          "anyOf": [
            { "type": "string" },
            {
              "pattern": "^CDISC\\.SDTMIG\\.CG\\d{4}$",
              "type": "string"
            }
          ]
        },
        "Version": {
          "const": "1"
        }
      },
      "required": ["Id", "Version"],
      "type": "object"
    },
    "Description": {
      "type": "string"
    },
    "Match Datasets": {
      "items": {
        "additionalProperties": false,
        "properties": {
          "Name": {
            "anyOf": [
              {
                "$ref": "#/$defs/Dataset"
              },
              {
                "$ref": "#/$defs/DataStructure"
              }
            ]
          },
          "Is Relationship": {
            "const": true
          },
          "Keys": {
            "items": {
              "$ref": "#/$defs/VariableName"
            },
            "type": "array"
          }
        },
        "required": ["Name", "Keys"],
        "type": "object"
      },
      "type": "array"
    },
    "Operations": {
      "items": {
        "additionalProperties": false,
        "properties": {
          "domain": {
            "anyOf": [
              {
                "$ref": "#/$defs/Dataset"
              },
              {
                "$ref": "#/$defs/DataStructure"
              }
            ]
          },
          "group": {
            "items": {
              "$ref": "#/$defs/VariableName"
            },
            "type": "array"
          },
          "id": {
            "$ref": "#/$defs/OperationId"
          },
          "name": {
            "type": "string"
          },
          "operator": {
            "enum": [
              "distinct",
              "dy",
              "extract_metadata",
              "get_column_order_from_dataset",
              "get_column_order_from_library",
              "max",
              "max_date",
              "mean",
              "min",
              "min_date",
              "record_count",
              "valid_meddra_code_references",
              "valid_meddra_code_term_pairs",
              "valid_meddra_term_references",
              "valid_whodrug_references",
              "variable_count",
              "variable_exists",
              "variable_names",
              "variable_permissibilities",
              "variable_value_count",
              "whodrug_code_hierarchy"
            ],
            "type": "string"
          }
        },
        "required": ["id", "operator"],
        "type": "object"
      },
      "type": "array"
    },
    "Outcome": {
      "additionalProperties": false,
      "properties": {
        "Message": {
          "type": "string"
        },
        "Output Variables": {
          "items": {
            "oneOf": [
              {
                "$ref": "#/$defs/OperationId"
              },
              {
                "$ref": "#/$defs/VariableName"
              }
            ]
          },
          "type": "array"
        }
      },
      "required": ["Message"],
      "type": "object"
    },
    "References": {
      "items": {
        "anyOf": [
          {
            "additionalProperties": false,
            "properties": {
              "Origin": {
                "type": "string"
              },
              "Rule Identifier": {
                "additionalProperties": false,
                "properties": {
                  "Id": {
                    "type": "string"
                  },
                  "Version": {
                    "type": "string"
                  }
                },
                "required": ["Id"],
                "type": "object"
              },
              "Version": {
                "type": "string"
              }
            },
            "required": ["Origin", "Rule Identifier", "Version"],
            "type": "object"
          },
          {
            "additionalProperties": false,
            "properties": {
              "Origin": {
                "const": "ADaM Conformance Rules"
              },
              "Rule Identifier": {
                "additionalProperties": false,
                "properties": {
                  "Id": {
                    "pattern": "^\\d{1,3}(\\.\\d{1,2})?$"
                  }
                },
                "required": ["Id"],
                "type": "object"
              },
              "Version": {
                "enum": ["4.0"]
              }
            },
            "required": ["Origin", "Rule Identifier", "Version"],
            "type": "object"
          },
          {
            "additionalProperties": false,
            "properties": {
              "Origin": {
                "const": "SDTM and SDTMIG Conformance Rules"
              },
              "Rule Identifier": {
                "additionalProperties": false,
                "properties": {
                  "Id": {
                    "pattern": "^CG\\d{4}$"
                  },
                  "Version": {
                    "enum": ["1", "2", "3"]
                  }
                },
                "required": ["Id", "Version"],
                "type": "object"
              },
              "Version": {
                "enum": ["2.0"]
              }
            },
            "required": ["Origin", "Rule Identifier", "Version"],
            "type": "object"
          },
          {
            "additionalProperties": false,
            "properties": {
              "Origin": {
                "const": "SEND Conformance Rules"
              },
              "Rule Identifier": {
                "additionalProperties": false,
                "properties": {
                  "Id": {
                    "pattern": "^\\d{1,3}(\\.\\d)?$"
                  }
                },
                "required": ["Id"],
                "type": "object"
              },
              "Version": {
                "enum": ["4.0"]
              }
            },
            "required": ["Origin", "Rule Identifier", "Version"],
            "type": "object"
          }
        ]
      },
      "minItems": 1,
      "type": "array"
    },
    "Rule Type": {
      "enum": [
        "Consistency",
        "Data Domain Aggregation",
        "Data Pattern and Format",
        "Dataset Contents Check against Define XML and Library Metadata",
        "Dataset Metadata Check",
        "Dataset Metadata Check against Define XML",
        "Date Arithmetic",
        "Define-XML",
        "Domain Presence Check",
        "External Dictionaries",
        "Functional Dependency",
        "Populated Values",
        "Range & Limit",
        "Relationship Integrity Check",
        "Uniqueness",
        "Value Level Metadata Check against Define XML",
        "Value Presence",
        "Variable Length",
        "Variable Metadata Check",
        "Variable Metadata Check against Define XML",
        "Variable Order",
        "Variable Presence"
      ],
      "type": "string"
    },
    "Scopes": {
      "additionalProperties": false,
      "properties": {
        "Classes": {
          "oneOf": [
            {
              "additionalProperties": false,
              "properties": {
                "Include": {
                  "$ref": "#/$defs/Classes"
                }
              },
              "required": ["Include"],
              "type": "object"
            },
            {
              "additionalProperties": false,
              "properties": {
                "Exclude": {
                  "$ref": "#/$defs/Classes"
                }
              },
              "required": ["Exclude"],
              "type": "object"
            }
          ]
        },
        "Data Structures": {
          "oneOf": [
            {
              "additionalProperties": false,
              "properties": {
                "Include": {
                  "$ref": "#/$defs/DataStructures"
                }
              },
              "required": ["Include"],
              "type": "object"
            },
            {
              "additionalProperties": false,
              "properties": {
                "Exclude": {
                  "$ref": "#/$defs/DataStructures"
                }
              },
              "required": ["Exclude"],
              "type": "object"
            }
          ]
        },
        "Datasets": {
          "additionalProperties": false,
          "properties": {
            "Exclude": {
              "$ref": "#/$defs/Datasets"
            },
            "Include": {
              "$ref": "#/$defs/Datasets"
            }
          },
          "type": "object"
        },
        "Domains": {
          "additionalProperties": false,
          "properties": {
            "Exclude": {
              "$ref": "#/$defs/Domains"
            },
            "Include": {
              "$ref": "#/$defs/Domains"
            },
            "include_split_datasets": {
              "type": "boolean"
            }
          },
          "type": "object"
        },
        "Standards": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "Name": {
                "type": "string"
              },
              "Version": {
                "type": "string"
              }
            },
            "required": ["Name", "Version"],
            "type": "object"
          },
          "type": "array"
        },
        "Subclasses": {
          "additionalProperties": false,
          "properties": {
            "Exclude": {
              "$ref": "#/$defs/Subclasses"
            },
            "Include": {
              "$ref": "#/$defs/Subclasses"
            }
          },
          "type": "object"
        }
      },
      "oneOf": [
        {
          "required": ["Classes", "Domains", "Standards"]
        },
        {
          "required": ["Data Structures", "Standards"]
        }
      ],
      "type": "object"
    },
    "Sensitivity": {
      "enum": ["Dataset", "Record"],
      "type": "string"
    },
    "Severity": {
      "enum": ["Error", "Notice", "Reject", "Warning"],
      "type": "string"
    }
  },
  "required": [
    "Authority",
    "Check",
    "Core",
    "Description",
    "Outcome",
    "References",
    "Rule Type",
    "Scopes",
    "Sensitivity",
    "Severity"
  ],
  "type": "object"
}
